var $sspjs={user:null,run:function(n,t){$(document).ready(function(){ExecuteOrDelayUntilScriptLoaded(function(){if(!_spPageContextInfo)throw"No SharePoint context available!";$sspjs.sp.initContext(t);$sspjs.config.cachePrefix=$sspjs._hash(_spPageContextInfo.webAbsoluteUrl);$sspjs.config.webAbsoluteUrl=_spPageContextInfo.webAbsoluteUrl+"/";$sspjs.config.siteRelativeUrl=_spPageContextInfo.siteServerRelativeUrl+(_spPageContextInfo.siteServerRelativeUrl!=="/"?"/":"");$sspjs.config.layoutsUrl=_spPageContextInfo.layoutsUrl+"/";$sspjs.config.imagesPath=$sspjs.config.webAbsoluteUrl+$sspjs.config.layoutsUrl+"images/";$sspjs.config.language=_spPageContextInfo.currentCultureName;$sspjs.config.languageUI=_spPageContextInfo.currentUICultureName;var r=_spPageContextInfo.webServerRelativeUrl+"/",i=$sspjs.sp.getCurrentUserAsync();i.done(function(t){$sspjs.user=t;$sspjs.logger.log("user: "+t.name);$sspjs._injectAndExecute(n)});i.fail(function(n,t){$sspjs.logger.log(t)})},"sp.js")})},sp:{_context:null,_getSpContext:function(n,t){return($sspjs.sp._context===null||t===!0)&&(n||($sspjs.sp._context=SP.ClientContext.get_current()),$sspjs.sp._context=new SP.ClientContext(n)),$sspjs.sp._context},_getWeb:function(n){var t=$sspjs.sp._getSpContext(n);return t.get_web()},_getList:function(n){var t=$sspjs.sp._getWeb(n);return t.get_lists().getByTitle(n.listname)},_getItem:function(n){var t=$sspjs.sp._getList(n);return t.getItemById(n.id)},_executeAsync:function(n,t,i){var u=$sspjs.sp._getSpContext(),r;if(n)for(r=0;r<n.length;r++)u.load(n[r]);u.executeQueryAsync(t,i)},_getFileBufferAsync:function(n){var t=$.Deferred(),i=new FileReader;return i.onloadend=function(n){t.resolve(n.target.result)},i.onerror=function(n){t.reject(n.target.error)},i.readAsArrayBuffer(n),t.promise()},_addFileToFolderAsync:function(n,t,i){var r=new $.Deferred,u=n.split("\\"),f=u[u.length-1],e=$sspjs.config.siteRelativeUrl+"_api/web/getfolderbyserverrelativeurl('"+t+"')/files/add(overwrite=true, url='"+f+"')";return $.ajax({url:e,type:"POST",data:i,processData:!1,headers:{accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()},success:function(n,t,i){r.resolve(n.d,t,i)},error:function(n,t,i){r.reject(n,t,i)}}),r.promise()},initContext:function(n){return $sspjs.sp._getSpContext(n)},getCurrentUserAsync:function(){var f="CURRENT_USER",n=new $.Deferred,i=$sspjs.cache.get(f);if(i&&i.login)return $sspjs.logger.log("Current user from cache: "+i.login),n.resolve(i),n.promise();var r=$sspjs.sp._getSpContext(),u=r.get_web(),t=u.get_currentUser();return r.load(t),r.load(u,"EffectiveBasePermissions"),r.executeQueryAsync(Function.createDelegate(this,function(){currentUser={id:t.get_id(),name:t.get_title(),email:t.get_email(),login:t.get_loginName()};currentUser.readonly=u.get_effectiveBasePermissions().has(SP.PermissionKind.editListItems)?!1:!0;$sspjs.cache.set(f,currentUser);n.resolve(currentUser)}),Function.createDelegate(this,function(t,i){currentUser=null;n.reject(t,i.get_message(),i)})),n.promise()},hasPermissionAsync:function(n){var t=new $.Deferred,i=$sspjs.sp._getSpContext(),r=i.get_web(),u=r.get_currentUser();return i.load(u),i.load(r,"EffectiveBasePermissions"),i.executeQueryAsync(Function.createDelegate(this,function(){r.get_effectiveBasePermissions().has(n)?t.resolve(!0):t.resolve(!1)}),Function.createDelegate(this,function(n,i){t.reject(n,i.get_message(),i)})),t.promise()},setWebPropertyAsync:function(n,t){var i=new $.Deferred,r=$sspjs.sp._getWeb(),u=r.get_allProperties();return u.set_item(n,t+""),r.update(),$sspjs.sp._executeAsync([r],function(n,t){i.resolve(t)},function(n,t){i.reject(n,t.get_message(),t)}),i.promise()},getWebPropertyAsync:function(n){var t=new $.Deferred,i=$sspjs.sp._getWeb(),r=i.get_allProperties();return $sspjs.sp._executeAsync([i,r],function(){var i=r.get_item(n);t.resolve(i)},function(n,i){t.reject(n,i)}),t.promise()},getWebPropertiesAsync:function(n){var t=new $.Deferred,i=$sspjs.sp._getWeb(),r=i.get_allProperties();return $sspjs.sp._executeAsync([i,r],function(){for(var u,f={},i=0;i<n.length;i++)try{u=r.get_item(n[i]);u!==undefined&&u!==null&&(f[n[i]]=u)}catch(e){$sspjs.logger.log(e)}t.resolve(f)},function(n,i){t.reject(n,i)}),t.promise()},getListFieldsAsync:function(n){var t=new $.Deferred,u="LIST_FIELDS_"+n,i=$sspjs.cache.get(u),f,r;return i&&i.length?($sspjs.logger.log("Fields from cache: "+i.length),t.resolve(i),t.promise()):(f=$sspjs.sp._getList({listname:n}),r=f.get_fields(),$sspjs.sp._executeAsync([r],function(){for(var f=r.getEnumerator(),i=[],n;f.moveNext();)n=f.get_current(),n.get_hidden()!=!0&&i.push({internalName:n.get_internalName(),title:n.get_title(),type:n.get_fieldTypeKind()==0&&n.get_typeAsString()==="TaxonomyFieldType"?1e3:n.get_fieldTypeKind()});$sspjs.logger.log(i.length+" fields received.");$sspjs.cache.set(u,i);t.resolve(i)},function(n,i){t.reject(n,i.get_message(),i)}),t.promise())},getListItemsAsync:function(n,t,i,r){var f;r||(r=100);var e=new $.Deferred,u=new $sspjs.sp._getSpContext,s=u.get_web().get_lists().getByTitle(n),o=new SP.CamlQuery;return o.set_viewXml("<View><RowLimit>"+r+"<\/RowLimit><\/View>"),i&&o.set_viewXml(i),f=s.getItems(o),t!==undefined&&t!==null?($sspjs.logger.log("requested fields: "+t.join(", ")),u.load(f,"Include("+t.join(", ")+")")):u.load(f),u.executeQueryAsync(Function.createDelegate(this,function(){for(var n=[],t=f.getEnumerator(),i;t.moveNext();)i=t.get_current(),n.push(i);$sspjs.logger.log(n.length+" items received.");e.resolve(n)}),Function.createDelegate(this,function(n,t){e.reject(n,t.get_message(),t)})),e.promise()},getListItemByIdAsync:function(n,t){var i=new $.Deferred,u=$sspjs.sp._getList({listname:n}),r=u.getItemById(t);return $sspjs.sp._executeAsync([r],function(){i.resolve(r)},function(n,t){i.reject(n,t.get_message(),t)}),i.promise()},getListItemByFileUrlAsync:function(n){var t=new $.Deferred;return $.ajax({url:n,type:"GET",headers:{accept:"application/json;odata=verbose"},success:function(n){t.resolve(n.d)},error:function(n,i,r){t.reject(this,"no item found.",{xhr:n,ajax:i,error:r})}}),t.promise()},addListItemAsync:function(n,t,i){var f=new $.Deferred,e=$sspjs.sp._getList({listname:n}),o=new SP.ListItemCreationInformation,r=e.addItem(o);for(var u in t)t[u]!==undefined&&t[u]!==null&&r.set_item(u,t[u]);return i&&$.isFunction(i)&&i(r),r.update(),$sspjs.sp._executeAsync([r],function(){f.resolve(r)},function(n,t){f.reject(n,t.get_message(),t)}),f.promise()},updateListItemAsync:function(n,t,i,r){var e=new $.Deferred,o=$sspjs.sp._getList({listname:n}),u=o.getItemById(t);for(var f in i)i[f]!==undefined&&i[f]!==null&&f!=="Id"&&u.set_item(f,i[f]);return r&&$.isFunction(r)&&r(u),u.update(),$sspjs.sp._executeAsync([u],function(){e.resolve(u)},function(n,t){e.reject(n,t.get_message(),t)}),e.promise()},deleteListItemByIdAsync:function(n,t){var i=new $.Deferred,r=new $sspjs.sp._getList({listname:n}),u=r.getItemById(t);return u.deleteObject(),$sspjs.sp._executeAsync(null,function(){i.resolve(t)},function(n,t){i.reject(n,t.get_message(),t)}),i.promise()},getUserByIdAsync:function(n){var i=new $.Deferred,u="USER"+n,r=$sspjs.cache.get(u),f,t;return r&&r.login?($sspjs.logger.log("User from cache: "+r.login),i.resolve(r),i.promise()):(f=$sspjs.sp._getWeb(),t=f.getUserById(n),$sspjs.sp._executeAsync([t],function(){var n={id:t.get_id(),name:t.get_title(),email:t.get_email(),login:t.get_loginName()};$sspjs.cache.set(u,n);i.resolve(n)},function(n,t){i.reject(n,t.get_message(),t)}),i.promise())},getUserLink:function(n){return $sspjs.config.webAbsoluteUrl+$sspjs.config.layoutsUrl+"userdisp.aspx?ID="+n},loadUserDataAsync:function(n,t){var i=new $.Deferred,f="USER"+n,u=$sspjs.cache.get(f);if(u&&u.LargeImage)return $sspjs.logger.log("UserData from cache: "+n),i.resolve(u),i.promise();t||(t=["PreferredName","PictureURL"]);var r=$sspjs.sp._getSpContext(),o=new SP.UserProfiles.PeopleManager(r),s=t,e=new SP.UserProfiles.UserProfilePropertiesForUser(r,n,s);return userProfileProperties=o.getUserProfilePropertiesFor(e),r.load(e),r.executeQueryAsync(Function.createDelegate(this,function(){for(var r={},n=0;n<t.length;n++)r[t[n]]=userProfileProperties[n];$sspjs.cache.set(f,r);i.resolve(r)}),Function.createDelegate(this,function(n,t){i.reject(n,"can not load user data",t)})),i.promise()},uploadFileAsync:function(n,t,i,r){var u=new $.Deferred,f=this,o=""+n+(r?"/"+r:""),e=$sspjs.sp._getFileBufferAsync(i.files[0]);return e.done(function(n){var t=$sspjs.sp._addFileToFolderAsync(i.value,o,n);t.done(function(n){var t=n.ListItemAllFields.__deferred.uri+"",i=$sspjs.sp.getListItemByFileUrlAsync(t);i.done(function(n){u.resolve(n,t)});i.fail(function(n,t,i){u.reject(n,t,i)})});t.fail(function(n,t,i){u.reject(f,"file can not be uploaded",{xhr:n,ajax:t,error:i})})}),e.fail(function(n){u.reject(f,"file can not be converted",n)}),u.promise()}},resources:{"default":{},init:function(n){$sspjs.resources.default=n},add:function(n,t,i){$sspjs.resources[n]||($sspjs.resources[n]={});$sspjs.resources[n][t]=i},getText:function(n,t){var i,r=n;return t||(t=$sspjs.config.language),i=$sspjs.resources[t],i||(i=$sspjs.resources.default),i[n]!==undefined&&i[n]!==null&&(r=i[n]),r}},logger:{log:function(n){try{console&&console.log&&$sspjs.config.doLogging===!0&&console.log(n)}catch(t){}}},config:{doCache:!0,cacheExpires:5,doLogging:!1,cachePrefix:"0",webAbsoluteUrl:"",siteRelativeUrl:"/",layoutsUrl:"_layouts/15/",imagesPath:"",language:"en-US",languageUI:"en-US"},cache:{_setCookie:function(n,t){var i=new Date,r=JSON.stringify(t);i.setTime(i.getTime()+36e5);document.cookie=n+"="+r+";expires="+i.toUTCString()},_getCookie:function(n){var t=document.cookie.match("(^|;) ?"+n+"=([^;]*)(;|$)"),i=t?t[2]:null;return i?JSON.parse(i):null},_setSessionCache:function(n,t){var i=JSON.stringify(t);sessionStorage.setItem(n,i)},_getSessionCache:function(n){var t=sessionStorage.getItem(n);return t?JSON.parse(t):null},_clearSessionCache:function(){sessionStorage.clear()},set:function(n,t){n=$sspjs.config.cachePrefix+"_"+n;t={val:t,created:Date.now()};sessionStorage&&sessionStorage.setItem?$sspjs.cache._setSessionCache(n,t):$sspjs.cache._setCookie(n,t)},get:function(n){var t=null,i=null,r,u=Date.now();return $sspjs.config.doCache?(n=$sspjs.config.cachePrefix+"_"+n,t=sessionStorage&&sessionStorage.getItem?$sspjs.cache._getSessionCache(n):$sspjs.cache._getCookie(n),!t||!t.val)?null:(r=t.created,i=t.val,u-r>6e4*$sspjs.config.cacheExpires)?null:i:null},clear:function(){sessionStorage&&sessionStorage.setItem&&$sspjs.cache._clearSessionCache()}},_hash:function(n){var t=0;if(n.length==0)return t;for(i=0;i<n.length;i++)char=n.charCodeAt(i),t=(t<<5)-t+char,t=t&t;return t},_getFunctionParameters:function(n){return n.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/)|(\s))/mg,"").match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].split(/,/)},_injectAndExecute:function(n){var arguments=[],t=$sspjs._getFunctionParameters(n);return arguments=$sspjs._getParameterMapping(t),n.apply(null,arguments)},_getParameterMapping:function(n){var r,t=[];for(i=0;i<n.length;i++)n[i]&&n[i].length>0?(r=n[i].substring(1),t.push($sspjs[r])):t.push(null);return t}};
//# sourceMappingURL=sspjs-1.0.2.min.js.map
